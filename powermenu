#!/bin/bash

# Define power menu options with icons
options=(
  "ÔÄ£ Lock"
  "Û∞§Ñ Suspend"
  "Û∞çÉ Logout"
  "Û∞úâ Reboot"
  "Û∞ê• Shutdown"
)

# Launch main rofi menu
choice=$(printf '%s\n' "${options[@]}" | rofi -dmenu \
  -theme "$HOME/.config/rofi/themes/rosepine-moon.rasi" \
  -p "üåô  Power Menu")

# Exit if no selection
[ -z "$choice" ] && exit

# Confirmation prompt with icon
confirm() {
  prompt="$1"
  rofi -dmenu \
    -theme "$HOME/.config/rofi/themes/rosepine-moon.rasi" \
    -p "$prompt (yes/no)" <<<"no\nyes"
}

# Execute selected action
case "$choice" in
*Lock*)
  i3lock --radius 100 \
    -eki ~/Saver/shaded_landscape.png \
    --blur 5 \
    -F --ring-width 3 --time-str="%H:%M" -p default
  ;;
*Suspend*)
  i3lock --radius 100 -eki ~/Saver/shaded_landscape.png -F \
    --ring-width 3 --time-str="%H:%M" -p default
  # Cleanly suspend after lock and rofi closes
  (
    sleep 1
    pkill -u "$USER" -f 'rofi -dmenu'
    loginctl suspend
  ) &
  ;;
*Logout*)
  kill -15 -1
  ;;
*Reboot*)
  confirm=$(printf "n\ny" | rofi -dmenu \
    -theme ~/.config/rofi/themes/rosepine-moon.rasi \
    -p "Reboot? [y/n]" \
    -selected-row 0)
  [ "$confirm" = "y" ] && loginctl reboot
  ;;
*Shutdown*)
  confirm=$(printf "n\ny" | rofi -dmenu \
    -theme ~/.config/rofi/themes/rosepine-moon.rasi \
    -p "Shutdown? [y/n]" \
    -selected-row 0)
  [ "$confirm" = "y" ] && loginctl poweroff
  ;;
esac
